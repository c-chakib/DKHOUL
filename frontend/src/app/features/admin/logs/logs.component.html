<!-- frontend/src/app/features/admin/logs/logs.component.html -->
<div class="logs-container">
  <!-- Header -->
  <div class="logs-header">
    <h1>
      <mat-icon>article</mat-icon>
      System Logs
    </h1>
    <div class="header-actions">
      <button mat-raised-button color="accent" (click)="refreshLogs()">
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>
      <button mat-raised-button color="primary" (click)="exportLogs()">
        <mat-icon>download</mat-icon>
        Export CSV
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid" *ngIf="stats">
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon total">
          <mat-icon>article</mat-icon>
        </div>
        <div class="stat-content">
          <h3>{{ stats.totalLogs | number }}</h3>
          <p>Total Logs</p>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon today">
          <mat-icon>today</mat-icon>
        </div>
        <div class="stat-content">
          <h3>{{ stats.todayLogs | number }}</h3>
          <p>Today's Logs</p>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon errors">
          <mat-icon>error</mat-icon>
        </div>
        <div class="stat-content">
          <h3>{{ stats.levelStats?.error || 0 | number }}</h3>
          <p>Errors</p>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon warnings">
          <mat-icon>warning</mat-icon>
        </div>
        <div class="stat-content">
          <h3>{{ stats.levelStats?.warn || 0 | number }}</h3>
          <p>Warnings</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Filters -->
  <mat-card class="filters-card">
    <mat-card-content>
      <div class="filters-grid">
        <mat-form-field appearance="outline">
          <mat-label>Log Level</mat-label>
          <mat-select [(ngModel)]="filters.level" (selectionChange)="applyFilters()">
            <mat-option [value]="null">All Levels</mat-option>
            <mat-option value="debug">Debug</mat-option>
            <mat-option value="info">Info</mat-option>
            <mat-option value="warn">Warning</mat-option>
            <mat-option value="error">Error</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Component</mat-label>
          <mat-select [(ngModel)]="filters.component" (selectionChange)="applyFilters()">
            <mat-option [value]="null">All Components</mat-option>
            <mat-option *ngFor="let comp of components" [value]="comp">{{ comp }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Start Date</mat-label>
          <input matInput [matDatepicker]="startPicker" [(ngModel)]="filters.startDate" (dateChange)="applyFilters()">
          <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>End Date</mat-label>
          <input matInput [matDatepicker]="endPicker" [(ngModel)]="filters.endDate" (dateChange)="applyFilters()">
          <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search</mat-label>
          <input matInput [(ngModel)]="filters.search" (ngModelChange)="onSearchChange()" placeholder="Search logs...">
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>

        <button mat-raised-button (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          Clear Filters
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Error Trends Chart -->
  <mat-card class="chart-card" *ngIf="stats?.errorTrends && stats.errorTrends.length > 0">
    <mat-card-header>
      <mat-card-title>Error Trends (Last 24 Hours)</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="error-trends">
        <div *ngFor="let trend of stats.errorTrends" class="trend-bar">
          <div class="trend-label">{{ formatHour(trend._id) }}</div>
          <div class="trend-bar-container">
            <div class="trend-bar-fill" [style.width.%]="(trend.count / maxErrorCount) * 100"></div>
            <span class="trend-count">{{ trend.count }}</span>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Logs Table -->
  <mat-card class="logs-table-card">
    <mat-card-content>
      <div class="table-container">
        <table mat-table [dataSource]="logs" class="logs-table">
          <!-- Timestamp Column -->
          <ng-container matColumnDef="timestamp">
            <th mat-header-cell *matHeaderCellDef>Timestamp</th>
            <td mat-cell *matCellDef="let log">
              <div class="timestamp">
                {{ log.timestamp | date:'short' }}
              </div>
            </td>
          </ng-container>

          <!-- Level Column -->
          <ng-container matColumnDef="level">
            <th mat-header-cell *matHeaderCellDef>Level</th>
            <td mat-cell *matCellDef="let log">
              <mat-chip [class]="'level-' + log.level">
                <mat-icon>{{ getLevelIcon(log.level) }}</mat-icon>
                {{ log.level | uppercase }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Component Column -->
          <ng-container matColumnDef="component">
            <th mat-header-cell *matHeaderCellDef>Component</th>
            <td mat-cell *matCellDef="let log">
              <span class="component-badge">{{ log.component || 'N/A' }}</span>
            </td>
          </ng-container>

          <!-- Message Column -->
          <ng-container matColumnDef="message">
            <th mat-header-cell *matHeaderCellDef>Message</th>
            <td mat-cell *matCellDef="let log">
              <div class="message-cell" [title]="log.message">
                {{ log.message }}
              </div>
            </td>
          </ng-container>

          <!-- User Column -->
          <ng-container matColumnDef="user">
            <th mat-header-cell *matHeaderCellDef>User</th>
            <td mat-cell *matCellDef="let log">
              <div class="user-cell" *ngIf="log.userName">
                <mat-icon>person</mat-icon>
                {{ log.userName }}
              </div>
              <span *ngIf="!log.userName" class="na">N/A</span>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let log">
              <button mat-icon-button [matMenuTriggerFor]="menu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="viewLogDetails(log)">
                  <mat-icon>visibility</mat-icon>
                  View Details
                </button>
                <button mat-menu-item *ngIf="log.userId" (click)="viewUser(log.userId)">
                  <mat-icon>person</mat-icon>
                  View User
                </button>
              </mat-menu>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <!-- Loading Spinner -->
        <div class="loading-container" *ngIf="loading">
          <mat-spinner diameter="50"></mat-spinner>
        </div>

        <!-- No Data -->
        <div class="no-data" *ngIf="!loading && logs.length === 0">
          <mat-icon>inbox</mat-icon>
          <p>No logs found</p>
        </div>
      </div>

      <!-- Pagination -->
      <mat-paginator
        [length]="totalLogs"
        [pageSize]="pageSize"
        [pageSizeOptions]="[10, 25, 50, 100]"
        (page)="onPageChange($event)"
        showFirstLastButtons>
      </mat-paginator>
    </mat-card-content>
  </mat-card>
</div>
