<div class="conversations-container">
  <div class="header">
    <h2>Messages</h2>
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search {{ selectedTab === 0 ? 'conversations' : 'users' }}</mat-label>
      <input matInput [(ngModel)]="searchQuery" (input)="searchConversations(searchQuery)" placeholder="Search...">
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>
  </div>

  <mat-tab-group [(selectedIndex)]="selectedTab" (selectedIndexChange)="onTabChange($event)" class="message-tabs">
    <mat-tab label="Conversations">
      <mat-list class="conversations-list" *ngIf="!loading">
        <mat-list-item *ngFor="let conv of filteredConversations" (click)="selectConversation(conv._id)" class="conversation-item">
          <img matListItemAvatar [src]="conv.otherUser.avatar || '/assets/default-avatar.svg'" [alt]="conv.otherUser.name">
          <div matListItemTitle class="conversation-title">
            <span class="name">{{ conv.otherUser.name }}</span>
            <mat-chip *ngIf="isUserOnline(conv.otherUser._id)" class="online-badge">Online</mat-chip>
            <span class="timestamp">{{ conv.lastMessage?.createdAt | date:'short' }}</span>
          </div>
          <div matListItemLine class="conversation-preview">
            <span [class.unread]="conv.unreadCount > 0">{{ getLastMessagePreview(conv.lastMessage?.content || 'No messages yet') }}</span>
          </div>
          <mat-icon matListItemMeta *ngIf="conv.unreadCount > 0" [matBadge]="conv.unreadCount" matBadgeColor="warn" matBadgeSize="small">
            notifications
          </mat-icon>
        </mat-list-item>

        <div class="empty-state" *ngIf="filteredConversations.length === 0 && !loading">
          <mat-icon>chat_bubble_outline</mat-icon>
          <h3>No conversations yet</h3>
          <p>Switch to the "All Users" tab to start chatting!</p>
        </div>
      </mat-list>

      <div class="loading-container" *ngIf="loading">
        <mat-spinner></mat-spinner>
      </div>
    </mat-tab>

    <mat-tab label="All Users">
      <mat-list class="users-list">
        <mat-list-item *ngFor="let user of filteredUsers" class="user-item">
          <img matListItemAvatar [src]="user.avatar || '/assets/default-avatar.svg'" [alt]="user.name">
          <div matListItemTitle class="user-title">
            <span class="name">{{ user.name }}</span>
            <mat-chip *ngIf="isUserOnline(user._id)" class="online-badge">
              <mat-icon>circle</mat-icon>
              Online
            </mat-chip>
          </div>
          <div matListItemLine class="user-email">
            {{ user.email }}
          </div>
          <button mat-raised-button color="primary" (click)="startChatWithUser(user._id)" class="chat-button">
            <mat-icon>chat</mat-icon>
            Chat
          </button>
        </mat-list-item>

        <div class="empty-state" *ngIf="filteredUsers.length === 0">
          <mat-icon>people_outline</mat-icon>
          <h3>No users found</h3>
          <p>Try adjusting your search terms.</p>
        </div>
      </mat-list>
    </mat-tab>
  </mat-tab-group>
</div>
