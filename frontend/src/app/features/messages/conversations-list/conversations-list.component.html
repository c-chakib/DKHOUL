<div class="conversations-container">
  <div class="header">
    <h2>Messages</h2>
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search conversations</mat-label>
      <input matInput [(ngModel)]="searchQuery" (input)="searchConversations(searchQuery)" placeholder="Search...">
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>
  </div>

  <mat-list class="conversations-list" *ngIf="!loading">
    <mat-list-item *ngFor="let conv of filteredConversations" (click)="selectConversation(conv._id)" class="conversation-item">
      <img matListItemAvatar [src]="conv.otherUser.avatar || '/assets/default-avatar.png'" [alt]="conv.otherUser.name">
      <div matListItemTitle class="conversation-title">
        <span class="name">{{ conv.otherUser.name }}</span>
        <span class="timestamp">{{ conv.lastMessage?.createdAt | date:'short' }}</span>
      </div>
      <div matListItemLine class="conversation-preview">
        <span [class.unread]="conv.unreadCount > 0">{{ getLastMessagePreview(conv.lastMessage?.content || 'No messages yet') }}</span>
      </div>
      <mat-icon matListItemMeta *ngIf="conv.unreadCount > 0" [matBadge]="conv.unreadCount" matBadgeColor="warn" matBadgeSize="small">
        notifications
      </mat-icon>
    </mat-list-item>

    <div class="empty-state" *ngIf="filteredConversations.length === 0">
      <mat-icon>chat_bubble_outline</mat-icon>
      <h3>No conversations yet</h3>
      <p>Start browsing services and connect with hosts!</p>
    </div>
  </mat-list>

  <div class="loading-container" *ngIf="loading">
    <mat-spinner></mat-spinner>
  </div>
</div>
