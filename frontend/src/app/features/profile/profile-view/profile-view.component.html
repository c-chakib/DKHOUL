<div class="profile-container" *ngIf="!loading">
  <!-- Cover Photo -->
  <div class="cover-photo" [style.background-image]="'url(' + (user?.coverPhoto || '/assets/default-cover.svg') + ')'">
    <button mat-fab class="edit-cover" *ngIf="isOwnProfile" (click)="editProfile()">
      <mat-icon>photo_camera</mat-icon>
    </button>
  </div>

  <!-- Profile Header -->
  <div class="profile-header">
    <div class="avatar-section">
      <img class="avatar" [src]="user?.avatar || '/assets/default-avatar.svg'" [alt]="user?.name">
      <mat-icon class="verified-badge" *ngIf="user?.verified">verified</mat-icon>
    </div>

    <div class="info-section">
      <h1>{{ user?.name }}</h1>
      <p class="role">{{ user?.role }}</p>
      <div class="rating" *ngIf="stats.averageRating > 0">
        <mat-icon>star</mat-icon>
        <span>{{ stats.averageRating.toFixed(1) }}</span>
        <span class="reviews-count">({{ stats.totalReviews }} reviews)</span>
      </div>
      <p class="bio">{{ user?.bio }}</p>
      <div class="badges">
        <mat-chip *ngIf="user?.verified">Verified</mat-chip>
        <mat-chip *ngIf="user?.superhost">Superhost</mat-chip>
        <mat-chip>Joined {{ user?.createdAt | date:'MMMM yyyy' }}</mat-chip>
      </div>
    </div>

    <div class="actions-section">
      <button mat-raised-button color="primary" *ngIf="isOwnProfile" (click)="editProfile()">
        <mat-icon>edit</mat-icon>
        Edit Profile
      </button>
      <button mat-raised-button color="accent" *ngIf="!isOwnProfile" (click)="sendMessage()">
        <mat-icon>message</mat-icon>
        Send Message
      </button>
    </div>
  </div>

  <!-- Stats Section -->
  <div class="stats-section">
    <mat-card class="stat-card">
      <mat-icon>business</mat-icon>
      <h3>{{ stats.totalServices }}</h3>
      <p>Services</p>
    </mat-card>
    <mat-card class="stat-card">
      <mat-icon>event</mat-icon>
      <h3>{{ stats.totalBookings }}</h3>
      <p>Bookings</p>
    </mat-card>
    <mat-card class="stat-card">
      <mat-icon>rate_review</mat-icon>
      <h3>{{ stats.totalReviews }}</h3>
      <p>Reviews</p>
    </mat-card>
    <mat-card class="stat-card">
      <mat-icon>schedule</mat-icon>
      <h3>{{ stats.responseRate }}%</h3>
      <p>Response Rate</p>
    </mat-card>
  </div>

  <!-- Tabbed Content -->
  <mat-tab-group class="profile-tabs">
    <mat-tab label="About">
      <mat-card class="tab-content">
        <h2>About {{ user?.name }}</h2>
        <div class="about-grid">
          <div class="about-item" *ngIf="user?.location">
            <mat-icon>location_on</mat-icon>
            <div>
              <strong>Location</strong>
              <p>{{ user.location.city }}, {{ user.location.country }}</p>
            </div>
          </div>
          <div class="about-item" *ngIf="user?.email">
            <mat-icon>email</mat-icon>
            <div>
              <strong>Email</strong>
              <p>{{ user.email }}</p>
            </div>
          </div>
          <div class="about-item" *ngIf="user?.phone">
            <mat-icon>phone</mat-icon>
            <div>
              <strong>Phone</strong>
              <p>{{ user.phone }}</p>
            </div>
          </div>
          <div class="about-item">
            <mat-icon>language</mat-icon>
            <div>
              <strong>Languages</strong>
              <p>{{ user?.languages?.join(', ') || 'Not specified' }}</p>
            </div>
          </div>
        </div>
        <div class="description" *ngIf="user?.description">
          <h3>Description</h3>
          <p>{{ user.description }}</p>
        </div>
      </mat-card>
    </mat-tab>

    <mat-tab label="Services" *ngIf="stats.totalServices > 0">
      <mat-card class="tab-content">
        <h2>Services by {{ user?.name }}</h2>
        <div class="services-grid">
          <div class="service-card" *ngFor="let service of services">
            <img [src]="service.images[0]" [alt]="service.name">
            <h3>{{ service.name }}</h3>
            <p>{{ service.category }}</p>
            <div class="service-footer">
              <span class="price">{{ service.price | currency:'MAD':'symbol':'1.0-0' }}/{{ service.priceUnit }}</span>
              <span class="rating">
                <mat-icon>star</mat-icon>
                {{ service.rating }}
              </span>
            </div>
          </div>
        </div>
      </mat-card>
    </mat-tab>

    <mat-tab label="Reviews" *ngIf="stats.totalReviews > 0">
      <mat-card class="tab-content">
        <h2>Reviews</h2>
        <div class="reviews-list">
          <div class="review-item" *ngFor="let review of reviews">
            <div class="review-header">
              <img [src]="review.user?.avatar" [alt]="review.user?.name">
              <div>
                <h4>{{ review.user?.name }}</h4>
                <p class="date">{{ review.createdAt | date:'mediumDate' }}</p>
              </div>
              <div class="rating">
                <mat-icon>star</mat-icon>
                {{ review.rating }}
              </div>
            </div>
            <p class="review-text">{{ review.comment }}</p>
          </div>
        </div>
      </mat-card>
    </mat-tab>
  </mat-tab-group>
</div>

<div class="loading-container" *ngIf="loading">
  <mat-spinner></mat-spinner>
  <p>Loading profile...</p>
</div>

