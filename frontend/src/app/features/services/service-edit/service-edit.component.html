<div class="service-edit-container" *ngIf="!loading">
  <div class="header">
    <h1>Edit Service</h1>
    <p>Update your service information</p>
  </div>

  <form [formGroup]="serviceForm" (ngSubmit)="onSubmit()">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Basic Information</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Service Title</mat-label>
          <input matInput formControlName="title">
          <mat-error>Title is required</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Description</mat-label>
          <textarea matInput formControlName="description" rows="6"></textarea>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Category</mat-label>
          <mat-select formControlName="category">
            <mat-option *ngFor="let category of categories" [value]="category">{{ category }}</mat-option>
          </mat-select>
        </mat-form-field>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-header>
        <mat-card-title>Photos ({{ existingImages.length + newFiles.length }} / 10)</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="image-grid">
          <div class="image-item" *ngFor="let image of existingImages; let i = index">
            <img [src]="image" alt="Service image">
            <button mat-icon-button class="remove-btn" type="button" (click)="removeExistingImage(i)">
              <mat-icon>close</mat-icon>
            </button>
          </div>
          <div class="image-item" *ngFor="let preview of newPreviews; let i = index">
            <img [src]="preview" alt="New image">
            <button mat-icon-button class="remove-btn" type="button" (click)="removeNewImage(i)">
              <mat-icon>close</mat-icon>
            </button>
            <span class="new-badge">NEW</span>
          </div>
        </div>
        <input type="file" #fileInput multiple accept="image/*" (change)="onFileSelected($event)" style="display: none">
        <button mat-raised-button color="primary" type="button" (click)="fileInput.click()" 
                [disabled]="existingImages.length + newFiles.length >= 10">
          <mat-icon>add_photo_alternate</mat-icon>
          Add Photos
        </button>
      </mat-card-content>
    </mat-card>

    <mat-card formGroupName="pricing">
      <mat-card-header>
        <mat-card-title>Pricing</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="pricing-grid">
          <mat-form-field appearance="outline">
            <mat-label>Amount</mat-label>
            <input matInput type="number" formControlName="amount">
            <span matTextPrefix>MAD&nbsp;</span>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Type</mat-label>
            <mat-select formControlName="type">
              <mat-option *ngFor="let type of pricingTypes" [value]="type.value">{{ type.label }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card formGroupName="location">
      <mat-card-header>
        <mat-card-title>Location</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Address</mat-label>
          <input matInput formControlName="address">
        </mat-form-field>
        <div class="location-grid">
          <mat-form-field appearance="outline">
            <mat-label>City</mat-label>
            <input matInput formControlName="city">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Region</mat-label>
            <input matInput formControlName="region">
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-header>
        <mat-card-title>Amenities</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="amenities-grid">
          <mat-checkbox *ngFor="let amenity of amenitiesList" [checked]="isAmenitySelected(amenity)"
                       (change)="toggleAmenity(amenity)">{{ amenity }}</mat-checkbox>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card formGroupName="availability">
      <mat-card-header>
        <mat-card-title>Availability</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <h3>Available Days</h3>
        <div class="days-grid">
          <mat-chip *ngFor="let day of daysOfWeek" [class.selected]="isDaySelected(day)" (click)="toggleDay(day)">{{ day }}</mat-chip>
        </div>
        <div class="time-grid">
          <mat-form-field appearance="outline">
            <mat-label>Start Time</mat-label>
            <input matInput type="time" formControlName="startTime">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>End Time</mat-label>
            <input matInput type="time" formControlName="endTime">
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>

    <div class="actions">
      <button mat-raised-button color="accent" type="submit" [disabled]="saving || serviceForm.invalid">
        <mat-spinner *ngIf="saving" diameter="20"></mat-spinner>
        {{ saving ? 'Saving...' : 'Save Changes' }}
      </button>
      <button mat-button type="button" (click)="cancel()" [disabled]="saving">Cancel</button>
      <button mat-button color="warn" type="button" (click)="deleteService()" [disabled]="saving">Delete Service</button>
    </div>
  </form>
</div>

<div class="loading-container" *ngIf="loading">
  <mat-spinner></mat-spinner>
  <p>Loading service...</p>
</div>

