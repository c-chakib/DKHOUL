<!-- Modern Professional Navbar -->
<header class="modern-navbar" [class.scrolled]="isScrolled">
  <div class="navbar-container">
    
    <!-- Logo - Always returns to Landing -->
    <a class="brand-logo" 
       (click)="navigateToLanding()" 
       (keydown.enter)="navigateToLanding()"
       (keydown.space)="navigateToLanding(); $event.preventDefault()"
       [attr.aria-label]="'DKHOUL - Discover Morocco - Return to home'"
       role="button"
       tabindex="0">
      <div class="logo-wrapper">
        <img src="/picture/overall/logo.png" alt="DKHOUL Logo" class="logo-image" loading="eager" width="48" height="48">
        <span class="logo-text">DKHOUL</span>
      </div>
    </a>

    <!-- Desktop Navigation -->
    <nav class="desktop-nav" role="navigation">
      
      <!-- Marketing Layout Navigation (Landing & Investor pages) -->
      <ng-container *ngIf="isMarketingLayout">
        <a class="nav-item" routerLink="/home" routerLinkActive="active">
          <span class="nav-icon">ğŸª</span>
          <span class="nav-label">Marketplace</span>
        </a>
        <a class="nav-item" routerLink="/investor" routerLinkActive="active">
          <span class="nav-icon">ğŸ“ˆ</span>
          <span class="nav-label">Investisseurs</span>
        </a>
      </ng-container>

      <!-- App Layout Navigation (Inside Marketplace) -->
      <ng-container *ngIf="!isMarketingLayout">
        <a class="nav-item" routerLink="/home" routerLinkActive="active">
          <span class="nav-icon">ğŸ </span>
          <span class="nav-label">Accueil</span>
        </a>
        <a class="nav-item" routerLink="/services" routerLinkActive="active">
          <span class="nav-icon">âœ¨</span>
          <span class="nav-label">Services</span>
        </a>
        <a class="nav-item" routerLink="/dashboard" routerLinkActive="active" *ngIf="isLoggedIn">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-label">Dashboard</span>
        </a>
        <a class="nav-item host-link" routerLink="/services/create" routerLinkActive="active" *ngIf="isProvider() || isAdmin()">
          <span class="nav-icon">â­</span>
          <span class="nav-label">Devenir Host</span>
        </a>
      </ng-container>
    </nav>

    <!-- Right Actions -->
    <div class="navbar-actions">
      
      <!-- Language Selector -->
      <div class="action-item language-selector">
        <button class="action-btn" [matMenuTriggerFor]="langMenu" aria-label="Changer la langue">
          <span class="flag-icon">{{ currentLanguageFlag }}</span>
        </button>
        <mat-menu #langMenu="matMenu" class="custom-menu">
          <button mat-menu-item (click)="changeLanguage('fr')" class="language-option">
            <span class="flag">ğŸ‡«ğŸ‡·</span>
            <span>FranÃ§ais</span>
            <mat-icon *ngIf="currentLanguage === 'fr'" class="check-icon">check</mat-icon>
          </button>
          <button mat-menu-item (click)="changeLanguage('ar')" class="language-option">
            <span class="flag">ğŸ‡²ğŸ‡¦</span>
            <span>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
            <mat-icon *ngIf="currentLanguage === 'ar'" class="check-icon">check</mat-icon>
          </button>
          <button mat-menu-item (click)="changeLanguage('en')" class="language-option">
            <span class="flag">ğŸ‡¬ğŸ‡§</span>
            <span>English</span>
            <mat-icon *ngIf="currentLanguage === 'en'" class="check-icon">check</mat-icon>
          </button>
        </mat-menu>
      </div>

      <!-- Messages (App only, logged in) -->
      <div class="action-item" *ngIf="isLoggedIn && !isMarketingLayout">
        <button class="action-btn" 
                (click)="navigateToMessages()" 
                [class.has-badge]="unreadMessages > 0" 
                [attr.aria-label]="unreadMessages > 0 ? 'Messages - ' + unreadMessages + ' unread' : 'Messages'"
                type="button"
                [attr.aria-busy]="false">
          <mat-icon>chat_bubble_outline</mat-icon>
          <span class="badge" 
                *ngIf="unreadMessages > 0"
                [attr.aria-label]="unreadMessages + ' unread messages'">
            {{ unreadMessages > 9 ? '9+' : unreadMessages }}
          </span>
        </button>
      </div>

      <!-- Favorites (App only, logged in) -->
      <div class="action-item" *ngIf="isLoggedIn && !isMarketingLayout">
        <button class="action-btn" 
                aria-label="Favoris - View favorites"
                type="button"
                disabled
                title="Coming soon">
          <mat-icon>favorite_border</mat-icon>
        </button>
      </div>

      <!-- Auth Buttons (Not logged in) -->
      <ng-container *ngIf="!isLoggedIn">
        <button class="btn-text" (click)="navigateToLogin()">
          Connexion
        </button>
        <button class="btn-primary" (click)="navigateToRegister()">
          S'inscrire
        </button>
      </ng-container>

      <!-- User Menu (Logged in, app only) -->
      <div class="action-item" *ngIf="isLoggedIn && !isMarketingLayout">
        <button class="action-btn user-btn" [matMenuTriggerFor]="userMenu" aria-label="Menu utilisateur">
          <div class="user-avatar">
            <img *ngIf="currentUser?.profilePicture" [src]="currentUser.profilePicture" [alt]="currentUser.firstName">
            <span *ngIf="!currentUser?.profilePicture" class="avatar-initials">
              {{ getInitials() }}
            </span>
          </div>
        </button>
        <mat-menu #userMenu="matMenu" class="custom-menu user-menu">
          <div class="user-menu-header">
            <div class="user-avatar-large">
              <img *ngIf="currentUser?.profilePicture" [src]="currentUser.profilePicture" [alt]="currentUser.firstName">
              <span *ngIf="!currentUser?.profilePicture" class="avatar-initials-large">
                {{ getInitials() }}
              </span>
            </div>
            <div class="user-details">
              <p class="user-name">{{ currentUser?.firstName }} {{ currentUser?.lastName }}</p>
              <p class="user-email">{{ currentUser?.email }}</p>
              <span class="user-role" [class.provider]="isProvider()" [class.admin]="isAdmin()">
                {{ getUserRole() }}
              </span>
            </div>
          </div>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="navigateToProfile()">
            <mat-icon>person_outline</mat-icon>
            <span>Mon Profil</span>
          </button>
          <button mat-menu-item (click)="navigateToDashboard()" *ngIf="isProvider() || isAdmin()">
            <mat-icon>dashboard</mat-icon>
            <span>Dashboard</span>
          </button>
          <button mat-menu-item (click)="navigateToBookings()">
            <mat-icon>event_note</mat-icon>
            <span>RÃ©servations</span>
          </button>
          <button mat-menu-item (click)="navigateToMessages()">
            <mat-icon>chat_bubble_outline</mat-icon>
            <span>Messages</span>
            <span class="menu-badge" *ngIf="unreadMessages > 0">{{ unreadMessages }}</span>
          </button>
          <button mat-menu-item *ngIf="isAdmin()" (click)="navigateToAdmin()">
            <mat-icon>admin_panel_settings</mat-icon>
            <span>Admin Panel</span>
          </button>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="logout()" class="logout-btn">
            <mat-icon color="warn">logout</mat-icon>
            <span>DÃ©connexion</span>
          </button>
        </mat-menu>
      </div>

      <!-- Mobile Menu Button -->
      <button class="mobile-menu-btn" 
              (click)="toggleMobileMenu()" 
              [attr.aria-label]="isMobileMenuOpen ? 'Close mobile menu' : 'Open mobile menu'"
              [attr.aria-expanded]="isMobileMenuOpen"
              aria-controls="mobile-menu"
              type="button">
        <span class="hamburger" [class.active]="isMobileMenuOpen">
          <span></span>
          <span></span>
          <span></span>
        </span>
      </button>
    </div>
  </div>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu" 
       [class.open]="isMobileMenuOpen"
       id="mobile-menu"
       [attr.aria-hidden]="!isMobileMenuOpen"
       role="dialog"
       aria-modal="true"
       aria-labelledby="mobile-menu-title">
    <div class="mobile-menu-content">
      
      <!-- Mobile Navigation Links -->
      <nav class="mobile-nav" role="navigation" aria-label="Mobile navigation">
        <!-- Marketing Layout -->
        <ng-container *ngIf="isMarketingLayout">
          <a class="mobile-nav-item" routerLink="/home" (click)="closeMobileMenu()" aria-label="Navigate to Marketplace">
            <span class="nav-icon">ğŸª</span>
            <span>Marketplace</span>
          </a>
          <a class="mobile-nav-item" routerLink="/investor" (click)="closeMobileMenu()" aria-label="Navigate to Investor page">
            <span class="nav-icon">ğŸ“ˆ</span>
            <span>Investisseurs</span>
          </a>
        </ng-container>

        <!-- App Layout -->
        <ng-container *ngIf="!isMarketingLayout">
          <a class="mobile-nav-item" routerLink="/home" (click)="closeMobileMenu()" aria-label="Navigate to Home">
            <span class="nav-icon">ğŸ </span>
            <span>Accueil</span>
          </a>
          <a class="mobile-nav-item" routerLink="/services" (click)="closeMobileMenu()" aria-label="Navigate to Services">
            <span class="nav-icon">âœ¨</span>
            <span>Services</span>
          </a>
          <a class="mobile-nav-item" routerLink="/dashboard" (click)="closeMobileMenu()" *ngIf="isLoggedIn" aria-label="Navigate to Dashboard">
            <span class="nav-icon">ğŸ“Š</span>
            <span>Dashboard</span>
          </a>
          <a class="mobile-nav-item" routerLink="/bookings" (click)="closeMobileMenu()" *ngIf="isLoggedIn" aria-label="Navigate to Bookings">
            <span class="nav-icon">ğŸ“…</span>
            <span>RÃ©servations</span>
          </a>
          <a class="mobile-nav-item" routerLink="/messages" (click)="closeMobileMenu()" *ngIf="isLoggedIn" [attr.aria-label]="unreadMessages > 0 ? 'Navigate to Messages - ' + unreadMessages + ' unread' : 'Navigate to Messages'">
            <span class="nav-icon">ğŸ’¬</span>
            <span>Messages</span>
            <span class="badge" *ngIf="unreadMessages > 0" [attr.aria-label]="unreadMessages + ' unread messages'">{{ unreadMessages }}</span>
          </a>
          <a class="mobile-nav-item" routerLink="/profile" (click)="closeMobileMenu()" *ngIf="isLoggedIn" aria-label="Navigate to Profile">
            <span class="nav-icon">ğŸ‘¤</span>
            <span>Profil</span>
          </a>
        </ng-container>
      </nav>

      <!-- Mobile Auth Actions -->
      <div class="mobile-actions" *ngIf="!isLoggedIn">
        <button class="btn-mobile-text" (click)="navigateToLogin(); closeMobileMenu()" type="button" aria-label="Navigate to Login">
          Connexion
        </button>
        <button class="btn-mobile-primary" (click)="navigateToRegister(); closeMobileMenu()" type="button" aria-label="Navigate to Register">
          S'inscrire
        </button>
      </div>

      <!-- Mobile Logout -->
      <div class="mobile-actions" *ngIf="isLoggedIn">
        <button class="btn-mobile-logout" (click)="logout(); closeMobileMenu()" type="button" aria-label="Logout">
          <mat-icon>logout</mat-icon>
          <span>DÃ©connexion</span>
        </button>
      </div>
    </div>
  </div>
</header>
